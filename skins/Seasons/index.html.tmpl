## Copyright 2009-2018 Tom Keffer, Matthew Wall
## Distributed under terms of GPLv3.  See LICENSE.txt for your rights.
#errorCatcher Echo

#set $periods = ['day', 'week', 'month', 'year']

## The plot info is an array of pairs, where each pair is the plot name and an
## array of observations in the plot.  These should correspond with the plot
## definitions in the ImageGenerator configuration.

## FIXME: given a plot name, we should be able to query the ImageGenerator
## configuration dictionary to determine the observations that are required
## for that plot

#set $plot_info = [ ('barometer', ['barometer']), ('tempdew', ['outTemp', 'dewpoint']), ('tempfeel', ['windchill', 'heatindex']), ('hum', ['outHumidity']), ('wind', ['windSpeed']), ('winddir', ['windSpeed']), ('windvec', ['windSpeed']), ('rain', ['rain']), ('ET', ['ET']), ('UV', ['UV']), ('radiation', ['radiation']), ('tempin', ['inTemp']), ('humin', ['inHumidity']), ('tempext', ['extraTemp1', 'extraTemp2', 'extraTemp3']), ('humext', ['extraHumid1', 'extraHumid2', 'extraHumid3']), ('templeaf', ['leafTemp1', 'leafTemp2']), ('wetleaf', ['leafWet1', 'leafWet2']), ('tempsoil', ['soilTemp1', 'soilTemp2', 'soilTemp3', 'soilTemp4']), ('moistsoil', ['soilMoist1', 'soilMoist2', 'soilMoist3', 'soilMoist4']), ('pm', ['pm1_0', 'pm2_5', 'pm10_0']) ]

<!DOCTYPE html>
<html lang="$gettext('lang')">
  <head>
    <meta charset="UTF-8">
    <title>$station.location</title>
    <link rel="icon" type="image/png" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="seasons.css"/>
    #if $station.station_url
    <link rel="canonical" href="$station.station_url/$filename" />
    #end if
    <script src="seasons.js"></script>
  </head>

  <body onload="setup();">
    #include "titlebar.inc"
    
    <div id="contents">
      <div id="widget_group">
        #include "current.inc"
        #include "sunmoon.inc"
        #include "hilo.inc"
        #include "sensors.inc"
        #include "about.inc"
        #include "radar.inc"
        #include "satellite.inc"
        #include "map.inc"
      </div>

      <div id="plot_group">
        <div id="history_widget" class="widget">
          <div id="plot_title" class="widget_title">$gettext("History"):&nbsp;&nbsp;
            <a class="button_selected" id="button_history_day"
               onclick="choose_history('day')">$gettext("Day")</a>
            <a class="button" id="button_history_week"
               onclick="choose_history('week')">$gettext("Week")</a>
            <a class="button" id="button_history_month"
               onclick="choose_history('month')">$gettext("Month")</a>
            <a class="button" id="button_history_year"
               onclick="choose_history('year')">$gettext("Year")</a>
          </div>

#for period in $periods
          <div id="history_${period}" class="plot_container">
  #for plot_name, plot_data in $plot_info
    #set $show_plot = 0
    #for data in $plot_data
      #if $getVar('year.%s.has_data' % $data)
        #set $show_plot = 1
      #end if
    #end for
    #if $show_plot
            <img src="${period}${plot_name}.png" alt="${period}${plot_name}"/>
    #end if
  #end for
          </div>
#end for

        </div>
      </div>
    </div>

    <p class="footnote">
      $gettext("This station is controlled by <a href='https://weewx.com'>WeeWX</a>, an experimental weather software system written in Python.")
    </p>

    #include "analytics.inc"

</body>

</html>
